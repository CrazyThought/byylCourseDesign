# 专项3：图形化界面设计

## 1. 模块概述

图形化界面是用户与词法语法分析器生成器交互的主要窗口，负责提供直观的操作界面和结果展示。本模块使用Qt框架开发，实现了词法分析器生成和语法分析器生成的完整流程的可视化操作。

## 2. 设计思路

### 2.1 界面架构设计

采用模块化设计，将不同功能模块分离为独立的标签页，每个标签页负责特定功能：

- **词法分析器生成**：包含正则表达式输入、NFA、DFA、最小化DFA、词法分析器生成和测试
- **语法分析器生成**：包含文法输入、文法分析、分析表、词法分析结果和语法分析

### 2.2 设计原则

- **直观易用**：界面布局清晰，操作流程符合用户习惯
- **功能完整**：包含词法和语法分析的所有功能
- **实时反馈**：操作后立即显示结果，提供实时反馈
- **可视化展示**：使用图形化方式展示有限自动机和语法树
- **可扩展性**：设计支持后续功能扩展

## 3. 实现细节

### 3.1 主窗口结构

```
MainWindow
├── tabWidget  // 主标签页控件
│   ├── task1Tab  // 词法分析器生成标签页
│   └── task2Tab  // 语法分析器生成标签页
└── menuBar  // 菜单栏
```

### 3.2 词法分析器生成界面

词法分析器生成界面包含6个标签页：

#### 3.2.1 正则表达式标签页

- **功能**：输入和解析正则表达式
- **主要控件**：
  - QTextEdit：用于输入正则表达式
  - QPushButton：解析正则表达式按钮
  - QTableWidget：显示解析结果

#### 3.2.2 NFA标签页

- **功能**：显示NFA状态转移表和图形化表示
- **主要控件**：
  - QComboBox：切换查看总图或各独立NFA
  - QTableWidget：显示NFA状态转移表
  - QGraphicsView：图形化展示NFA

#### 3.2.3 DFA标签页

- **功能**：显示DFA状态转移表和图形化表示
- **主要控件**：
  - QComboBox：切换查看总图或各独立DFA
  - QTableWidget：显示DFA状态转移表
  - QGraphicsView：图形化展示DFA

#### 3.2.4 最小化DFA标签页

- **功能**：显示最小化DFA状态转移表和图形化表示
- **主要控件**：
  - QComboBox：切换查看总图或各独立最小化DFA
  - QTableWidget：显示最小化DFA状态转移表
  - QGraphicsView：图形化展示最小化DFA

#### 3.2.5 词法分析器标签页

- **功能**：生成和保存词法分析器代码
- **主要控件**：
  - QPushButton：生成词法分析器按钮
  - QPushButton：保存为.cpp按钮
  - QTextEdit：显示生成的词法分析器代码

#### 3.2.6 测试标签页

- **功能**：测试生成的词法分析器
- **主要控件**：
  - QTextEdit：输入测试文本
  - QPushButton：运行词法分析按钮
  - QTableWidget：显示词法分析结果

### 3.3 语法分析器生成界面

语法分析器生成界面包含6个标签页：

#### 3.3.1 文法输入标签页

- **功能**：输入和解析BNF文法
- **主要控件**：
  - QTextEdit：用于输入BNF文法
  - QPushButton：解析文法按钮
  - QTextBrowser：显示解析结果

#### 3.3.2 文法分析标签页

- **功能**：显示文法的详细信息
- **主要控件**：
  - QTreeWidget：显示文法的产生式
  - QListWidget：显示非终结符列表
  - QListWidget：显示终结符列表

#### 3.3.3 分析表标签页

- **功能**：显示生成的分析表
- **主要控件**：
  - QComboBox：选择分析方法（LL(1)、LR(0)、SLR(1)、LR(1)）
  - QPushButton：生成分析表按钮
  - QTableWidget：显示分析表

#### 3.3.4 词法分析结果标签页

- **功能**：输入词法分析结果
- **主要控件**：
  - QTextEdit：用于输入词法分析结果
  - QPushButton：加载词法分析结果按钮

#### 3.3.5 语法分析标签页

- **功能**：执行语法分析并显示步骤
- **主要控件**：
  - QPushButton：开始分析按钮
  - QTableWidget：显示语法分析步骤
  - QTextBrowser：显示分析结果

#### 3.3.6 语法树标签页

- **功能**：显示生成的语法树
- **主要控件**：
  - QGraphicsView：图形化展示语法树

### 3.4 核心代码实现

#### 3.4.1 主窗口初始化

```cpp
MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
    , ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    
    // 初始化标签页
    m_task1Window = new Task1Window(this);
    m_task2Window = new Task2Window(this);
    
    // 添加到主标签页
    ui->tabWidget->addTab(m_task1Window, tr("词法分析器生成"));
    ui->tabWidget->addTab(m_task2Window, tr("语法分析器生成"));
    
    // 设置窗口标题
    setWindowTitle(tr("词法语法分析器生成器"));
}
```

#### 3.4.2 正则表达式解析按钮点击事件

```cpp
void Task1Window::on_parseRegexButton_clicked() {
    // 获取正则表达式文本
    QString regexText = ui->regexTextEdit->toPlainText();
    
    // 解析正则表达式
    m_lexerGenerator.parseRegex(regexText);
    
    // 显示解析结果
    displayRegexParseResult();
}
```

#### 3.4.3 语法分析步骤显示

```cpp
void LR1Parser::stepUpdated(const ParseStep &step) {
    // 格式化步骤信息
    QString stepInfo = QString("步骤 %1: 栈: %2, 剩余输入: %3, 动作: %4, 产生式: %5")
        .arg(step.step)
        .arg(formatStack(step.stack))
        .arg(formatInput(step.rest))
        .arg(step.action)
        .arg(step.production);
    
    // 添加到UI显示
    ui->parseStepsTextEdit->append(stepInfo);
}
```

## 4. 图形化展示实现

### 4.1 有限自动机可视化

使用Qt的QGraphicsView和QGraphicsScene实现有限自动机的图形化展示：

1. **状态绘制**：使用QGraphicsEllipseItem绘制状态节点
2. **转换绘制**：使用QGraphicsLineItem绘制状态转换
3. **布局算法**：使用层次布局算法排列状态节点
4. **交互功能**：支持缩放、平移和选择

### 4.2 语法树可视化

使用Qt的QGraphicsView和QGraphicsScene实现语法树的图形化展示：

1. **节点绘制**：使用QGraphicsRectItem绘制树节点
2. **边绘制**：使用QGraphicsLineItem绘制树边
3. **布局算法**：使用深度优先遍历进行树布局
4. **交互功能**：支持缩放、平移和节点展开/折叠

## 5. 交互设计

### 5.1 操作流程

#### 5.1.1 词法分析器生成流程

1. 在"正则表达式"标签页输入正则表达式
2. 点击"解析正则表达式"按钮
3. 切换到"NFA"标签页查看NFA
4. 切换到"DFA"标签页查看DFA
5. 切换到"最小化DFA"标签页查看最小化DFA
6. 切换到"词法分析器"标签页生成词法分析器
7. 切换到"测试"标签页测试词法分析器

#### 5.1.2 语法分析器生成流程

1. 在"文法输入"标签页输入BNF文法
2. 点击"解析文法"按钮
3. 切换到"文法分析"标签页查看文法信息
4. 切换到"分析表"标签页选择分析方法并生成分析表
5. 在"词法分析结果"标签页输入词法分析结果
6. 切换到"语法分析"标签页执行语法分析
7. 切换到"语法树"标签页查看语法树

### 5.2 快捷键设计

| 功能 | 快捷键 |
|------|--------|
| 解析正则表达式 | Ctrl+R |
| 生成NFA | Ctrl+N |
| 生成DFA | Ctrl+D |
| 最小化DFA | Ctrl+M |
| 生成词法分析器 | Ctrl+G |
| 运行词法分析 | Ctrl+T |
| 解析文法 | Ctrl+P |
| 生成分析表 | Ctrl+A |
| 开始语法分析 | Ctrl+S |

## 6. 测试与验证

### 6.1 界面功能测试

- **测试目的**：验证界面各控件功能正常
- **测试方法**：手动操作各控件，检查功能是否符合预期
- **测试结果**：所有控件功能正常，无异常情况

### 6.2 界面响应测试

- **测试目的**：验证界面响应速度
- **测试方法**：输入大量正则表达式或文法，检查界面响应时间
- **测试结果**：界面响应及时，无卡顿现象

### 6.3 界面兼容性测试

- **测试目的**：验证界面在不同分辨率下的显示效果
- **测试方法**：在不同分辨率下运行程序，检查界面布局
- **测试结果**：界面布局自适应，在不同分辨率下均能正常显示

## 7. 性能优化

- **延迟加载**：对于计算密集型操作（如DFA生成），使用后台线程处理，避免界面卡顿
- **缓存机制**：对计算结果进行缓存，避免重复计算
- **图形优化**：优化图形绘制算法，提高图形化展示的性能
- **内存管理**：及时释放不再使用的资源，避免内存泄漏

## 8. 改进方向

- **主题支持**：添加深色主题和自定义主题支持
- **国际化支持**：添加多语言支持
- **拖拽功能**：支持文件拖拽导入
- **导出功能**：支持导出图形化结果为图片
- **撤销/重做功能**：添加操作的撤销和重做功能
- **自动补全**：为正则表达式和文法输入添加自动补全功能
- **语法高亮**：为正则表达式和文法输入添加语法高亮

## 9. 总结

图形化界面模块使用Qt框架实现了词法语法分析器生成器的完整可视化操作界面，提供了直观易用的用户体验。界面设计采用模块化结构，功能完整，实时反馈，可视化展示效果良好。通过测试验证，界面功能正常，响应及时，兼容性良好。后续可继续优化界面性能和用户体验，添加更多便捷功能。