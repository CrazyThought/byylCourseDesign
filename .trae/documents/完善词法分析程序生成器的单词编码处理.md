# 完善词法分析程序生成器的单词编码处理

## 问题分析

1. **当前问题**：
   - 单词编码没有正确提取和使用正则表达式名称后的数字
   - 多单词情况（名称后带S）没有生成连续编码
   - 接受状态映射错误，总是使用第一个正则表达式的编码
   - 词法分析结果显示错误的编码值

2. **根本原因**：
   - `generateAcceptStatesMap`函数错误地为所有接受状态分配了第一个正则表达式的编码
   - 缺少多单词处理逻辑，无法为每个具体单词生成独立编码
   - 正则表达式与DFA接受状态的映射关系未正确建立

## 解决方案

### 1. 修复接受状态映射生成

**文件**：`src/lexergenerator.cpp`
**函数**：`generateAcceptStatesMap`

- 问题：当前总是使用`regexItems[0].code`为所有接受状态分配编码
- 解决方案：建立正则表达式与DFA状态的正确映射关系，为每个接受状态分配对应的编码

### 2. 增强多单词处理逻辑

**文件**：`src/lexergenerator.cpp`
**函数**：`generateTokenCodeMap` 和词法分析器生成函数

- 问题：当前多单词处理只是生成一个编码，没有为每个具体单词生成独立编码
- 解决方案：
  - 在`generateTokenCodeMap`中为多单词生成连续编码
  - 在词法分析器中添加逻辑，根据匹配到的具体单词返回对应的编码
  - 为多单词生成特殊处理代码

### 3. 完善词法分析器生成

**文件**：`src/lexergenerator.cpp`
**函数**：`generateDirectMatchLexer` 和 `generateStateTransitionLexer`

- 问题：当前词法分析器没有处理多单词情况
- 解决方案：
  - 在直接匹配模式中添加多单词处理逻辑
  - 在状态转移模式中添加多单词处理逻辑
  - 确保每个具体单词都能返回正确的编码

### 4. 确保正则表达式与DFA状态映射

**文件**：`include/dfabuilder.h` 和相关文件

- 问题：当前DFA结构没有存储正则表达式与接受状态的映射关系
- 解决方案：扩展DFA结构，存储每个接受状态对应的正则表达式索引或编码

## 实现步骤

1. **修改DFA结构**：在`dfabuilder.h`中扩展DFA结构，添加接受状态到正则表达式的映射
2. **修复`generateAcceptStatesMap`函数**：确保每个接受状态映射到正确的正则表达式编码
3. **增强`generateTokenCodeMap`函数**：为多单词生成连续编码
4. **更新词法分析器生成函数**：添加多单词处理逻辑
5. **测试验证**：确保生成的词法分析器能正确处理单词编码和多单词情况

## 预期效果

- 单词编码正确提取自正则表达式名称，如`_num100`生成编码100
- 多单词情况如`_specail200S`生成连续编码：+→201, -→202, *→203等
- 词法分析结果显示正确的编码值，如{num:100, id:101, specail:200}
- 生成的词法分析器能正确处理所有单词，包括多单词情况

## 关键技术点

- 正则表达式解析与编码提取
- DFA状态与正则表达式的映射
- 多单词处理逻辑
- 词法分析器生成
- 状态转移表生成

通过以上修改，我们可以完善词法分析程序生成器的单词编码处理，确保生成的词法分析器能正确处理各种情况。